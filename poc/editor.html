<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Hotspot-Editor</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1rem;
    }

    .map-container {
      position: relative;
      max-width: 1000px;
      border: 1px solid #ccc;
    }

    img {
      width: 100%;
      display: block;
    }

    svg {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    circle {
      fill: #ff6600;
      stroke: #fff;
      stroke-width: 2;
    }

    polygon {
      fill: rgba(255, 102, 0, 0.3);
      stroke: #ff6600;
      stroke-width: 2;
    }

    #output {
      margin-top: 1em;
      width: 100%;
      max-width: 1000px;
      white-space: pre-wrap;
      background: #f9f9f9;
      border: 1px solid #ddd;
      padding: 1em;
      font-family: monospace;
    }

    .controls {
      margin-top: 1em;
    }

    button {
      padding: 0.5em 1em;
      margin-right: 0.5em;
      cursor: pointer;
    }
  </style>
</head>
<body>

<h2>Hotspot-Editor</h2>

<div class="map-container" id="map">
  <img src="gelaendekarte.jpg" alt="Geländekarte" id="karte">
  <svg id="overlay" viewBox="0 0 1000 700" preserveAspectRatio="xMidYMid meet"></svg>
</div>

<div class="controls">
  <button onclick="undo()">⟲ Letzter Punkt</button>
  <button onclick="reset()">✖ Reset</button>
  <button onclick="exportPolygon()">✔ Exportieren</button>
</div>

<pre id="output">Klicke auf die Karte, um Punkte für ein Polygon zu setzen.</pre>

<script>
  const svg = document.getElementById("overlay");
  const output = document.getElementById("output");
  const points = [];

  svg.addEventListener("click", (e) => {
    const rect = svg.getBoundingClientRect();
    const x = ((e.clientX - rect.left) / rect.width) * 1000;
    const y = ((e.clientY - rect.top) / rect.height) * 700;
    points.push([Math.round(x), Math.round(y)]);
    draw();
  });

  function draw() {
    svg.innerHTML = "";

    points.forEach(([x, y]) => {
      const c = document.createElementNS("http://www.w3.org/2000/svg", "circle");
      c.setAttribute("cx", x);
      c.setAttribute("cy", y);
      c.setAttribute("r", 5);
      svg.appendChild(c);
    });

    if (points.length > 2) {
      const polygon = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
      polygon.setAttribute("points", points.map(p => p.join(",")).join(" "));
      svg.appendChild(polygon);
    }

    output.textContent = `Aktuelle Punkte (${points.length}):\n` + points.map(p => p.join(",")).join(" ");
  }

  function undo() {
    points.pop();
    draw();
  }

  function reset() {
    points.length = 0;
    draw();
  }

  function exportPolygon() {
    if (points.length < 3) {
      output.textContent = "Mindestens 3 Punkte für ein Polygon!";
      return;
    }

    const exportString = `{
  "id": "hotspotXYZ",
  "title": "Neuer Hotspot",
  "text": "Beschreibung hier einfügen.",
  "image": "bild.jpg",
  "points": "${points.map(p => p.join(",")).join(" ")}"
}`;
    output.textContent = "Export:\n" + exportString;
  }
</script>

</body>
</html>
